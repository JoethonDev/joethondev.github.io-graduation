<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Image Search</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Swiper Slider CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/8.4.5/swiper-bundle.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- HTMX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/htmx/1.9.2/htmx.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
        }
        .search-container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 30px;
        }
        .product-card {
            height: 100%;
            transition: transform 0.3s;
            margin-bottom: 20px;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .product-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .product-description {
            font-size: 0.9rem;
            color: #6c757d;
        }
        .product-price {
            font-weight: 700;
            color: #0d6efd;
            font-size: 1.1rem;
        }
        .color-dot {
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .product-rating {
            color: #ffc107;
        }
        .swiper {
            width: 100%;
            height: 180px;
        }
        .swiper-slide img {
            width: 400px;
            height: 300px;
            object-fit: cover;
            border-top-left-radius: 0.375rem;
            border-top-right-radius: 0.375rem;
        }
        .camera-capture {
            display: none;
        }
        .arabic-text {
            direction: rtl;
            text-align: right;
            font-family: 'Arial', sans-serif;
        }
        .empty-results {
            text-align: center;
            padding: 50px;
            color: #6c757d;
        }
        .loading-indicator {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .htmx-request .loading-indicator {
            display: block;
        }
        .htmx-request.search-btn .spinner-border {
            display: inline-block !important;
        }
        .spinner-border {
            display: none !important;
        }
        #cameraView {
            width: 100%;
            max-height: 300px;
            display: none;
            margin-bottom: 10px;
        }
    </style>
    <style>
        body {
            background-color: #f8f9fa;
        }
        .search-container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 30px;
        }
        .product-card {
            height: 100%;
            transition: transform 0.3s;
            margin-bottom: 20px;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .product-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .product-description {
            font-size: 0.9rem;
            color: #6c757d;
        }
        .product-price {
            font-weight: 700;
            color: #0d6efd;
            font-size: 1.1rem;
        }
        .color-dot {
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .product-rating {
            color: #ffc107;
        }
        .swiper {
            width: 100%;
            height: 220px; /* Fixed height */
        }
        .swiper-slide img {
            width: 100%;
            height: 220px; /* Match swiper height */
            object-fit: contain; /* Changed to contain to avoid cropping */
            border-top-left-radius: 0.375rem;
            border-top-right-radius: 0.375rem;
            background-color: #f8f9fa; /* Light background for transparent images */
        }
        .camera-capture {
            display: none;
        }
        .arabic-text {
            direction: rtl;
            text-align: right;
            font-family: 'Arial', sans-serif;
        }
        .empty-results {
            text-align: center;
            padding: 50px;
            color: #6c757d;
        }
        .loading-indicator {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .htmx-request .loading-indicator {
            display: block !important;
        }
        .htmx-request.search-btn .spinner-border {
            display: inline-block !important;
        }
        .spinner-border {
            display: none !important;
        }
        #cameraView {
            width: 100%;
            max-height: 300px;
            display: none;
            margin-bottom: 10px;
            border-radius: 0.375rem;
        }
        /* Image preview styles */
        #imagePreviewContainer {
            margin-top: 10px;
            display: none;
        }
        #imagePreview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 0.375rem;
            border: 1px solid #dee2e6;
        }
        .preview-actions {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <h1 class="text-center mb-4">Product Image Search</h1>
        
        <div class="search-container">
            <form id="searchForm" class="row g-3" hx-post="https://0c8f-45-246-54-55.ngrok-free.app/search/" hx-target="#searchResults" hx-indicator="#loading" hx-encoding='multipart/form-data'>
                <div class="col-md-6">
                    <label for="searchQuery" class="form-label">Search Text</label>
                    <input type="text" class="form-control" id="searchQuery" name="text" placeholder="Enter product name, description, etc.">
                </div>
                
                <div class="col-md-6">
                    <label for="productImage" class="form-label">Product Image</label>
                    <div class="d-flex">
                        <!-- This is just for selecting files, not for submission -->
                        <input type="file" class="form-control me-2" id="fileSelector" accept="image/*">
                        <button type="button" class="btn btn-outline-primary" id="cameraBtn">
                            <i class="bi bi-camera"></i> Camera
                        </button>
                    </div>
                    <video id="cameraView" autoplay></video>
                    
                    <!-- Image Preview Container -->
                    <div id="imagePreviewContainer" class="text-center">
                        <img id="imagePreview" src="" alt="Image Preview">
                        <div class="preview-actions">
                            <button type="button" class="btn btn-sm btn-danger" id="removeImageBtn">
                                <i class="bi bi-trash"></i> Remove
                            </button>
                        </div>
                    </div>
                    
                    <!-- This is the actual input that will be submitted -->
                    <input type="hidden" id="actualImageInput" name="image">
                </div>
                
                <div class="col-12 text-center mt-4">
                    <button type="submit" class="btn btn-primary px-4 search-btn">
                        <span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
                        Search Products
                    </button>
                </div>
            </form>
        </div>
        
        <div id="loading" class="loading-indicator">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Searching for products...</p>
        </div>
        
        <div id="searchResults">
            <!-- Search results will appear here -->
            <div class="empty-results">
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-search mb-3" viewBox="0 0 16 16">
                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                </svg>
                <h4>No products found</h4>
                <p>Try searching for products using text or image</p>
            </div>
        </div>
    </div>


    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <!-- Swiper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/8.4.5/swiper-bundle.min.js"></script>
    
    <!-- <script>
        document.addEventListener('DOMContentLoaded', function() {
            const cameraBtn = document.getElementById('cameraBtn');
            const cameraView = document.getElementById('cameraView');
            const capturedImage = document.getElementById('capturedImage');
            let stream = null;
            
            // Camera functionality
            cameraBtn.addEventListener('click', async () => {
                if (cameraView.style.display === 'block') {
                    // Stop camera and capture image
                    if (stream) {
                        const videoTrack = stream.getVideoTracks()[0];
                        const canvas = document.createElement('canvas');
                        canvas.width = cameraView.videoWidth;
                        canvas.height = cameraView.videoHeight;
                        canvas.getContext('2d').drawImage(cameraView, 0, 0);
                        capturedImage.value = canvas.toDataURL('image/jpeg');
                        
                        // Stop camera
                        videoTrack.stop();
                        stream = null;
                        cameraView.style.display = 'none';
                        cameraBtn.textContent = 'Camera';
                    }
                } else {
                    try {
                        // Start camera
                        stream = await navigator.mediaDevices.getUserMedia({ video: true });
                        cameraView.srcObject = stream;
                        cameraView.style.display = 'block';
                        cameraBtn.textContent = 'Capture';
                    } catch (err) {
                        console.error('Error accessing camera:', err);
                        alert('Could not access camera. Please ensure you have given permission.');
                    }
                }
            });
            

            // For debugging HTMX requests
            document.body.addEventListener('htmx:beforeRequest', function(evt) {
                console.log('HTMX Request about to be sent:', evt.detail);
            });

            document.body.addEventListener('htmx:responseError', function(evt) {
                console.error('HTMX Response Error:', evt.detail);
            });
            
            // Mock API response for demonstration purposes
            document.body.addEventListener('htmx:beforeSend', function(evt) {
                evt.detail.xhr.onload = function() {
                    // Simulate a delay to show loading indicator
                    setTimeout(() => {
                        const mockProducts = generateMockProducts();
                        const resultsHtml = generateProductCards(mockProducts);
                        document.getElementById('searchResults').innerHTML = resultsHtml;
                        initSwipers();
                    }, 1500);
                };
                evt.preventDefault(); // Prevent the actual request
            });
            
            // Mock product data generator
            function generateMockProducts() {
                const products = [];
                const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
                
                for (let i = 1; i <= 8; i++) {
                    const productColors = [];
                    const colorCount = Math.floor(Math.random() * 3) + 1;
                    for (let j = 0; j < colorCount; j++) {
                        productColors.push(colors[Math.floor(Math.random() * colors.length)]);
                    }
                    
                    const imageCount = Math.floor(Math.random() * 3) + 1;
                    const images = [];
                    for (let j = 1; j <= imageCount; j++) {
                        images.push(`/api/placeholder/400/300?text=Product ${i} Image ${j}`);
                    }
                    
                    products.push({
                        id: i,
                        name: `Product ${i}`,
                        nameAr: `المنتج ${i}`,
                        description: `This is a detailed description for product ${i}. Features include high quality materials and modern design.`,
                        colors: productColors,
                        price: (Math.random() * 100 + 10).toFixed(2),
                        rating: (Math.random() * 5).toFixed(1),
                        images: images,
                        url: `#product-${i}`
                    });
                }
                return products;
            }
            
            // Generate HTML for product cards
            function generateProductCards(products) {
                if (products.length === 0) {
                    return `
                        <div class="empty-results">
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-search mb-3" viewBox="0 0 16 16">
                                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                            </svg>
                            <h4>No products found</h4>
                            <p>Try searching with different terms or image</p>
                        </div>
                    `;
                }
                
                let html = '<div class="row">';
                
                products.forEach(product => {
                    // Generate color dots
                    let colorDotsHtml = '';
                    product.colors.forEach(color => {
                        colorDotsHtml += `<span class="color-dot" style="background-color: ${color};"></span>`;
                    });
                    
                    // Generate star rating
                    const rating = parseFloat(product.rating);
                    let starsHtml = '';
                    for (let i = 1; i <= 5; i++) {
                        if (i <= Math.floor(rating)) {
                            starsHtml += '<i class="bi bi-star-fill"></i> ';
                        } else if (i === Math.ceil(rating) && rating % 1 !== 0) {
                            starsHtml += '<i class="bi bi-star-half"></i> ';
                        } else {
                            starsHtml += '<i class="bi bi-star"></i> ';
                        }
                    }
                    
                    // Generate image slider
                    let sliderHtml = `
                        <div class="swiper product-swiper-${product.id}">
                            <div class="swiper-wrapper">
                    `;
                    
                    product.images.forEach(image => {
                        sliderHtml += `
                            <div class="swiper-slide">
                                <img src="${image}" alt="${product.name}">
                            </div>
                        `;
                    });
                    
                    sliderHtml += `
                            </div>
                            <div class="swiper-pagination"></div>
                            <div class="swiper-button-next"></div>
                            <div class="swiper-button-prev"></div>
                        </div>
                    `;
                    
                    html += `
                        <div class="col-sm-6 col-md-4 col-lg-3">
                            <div class="card product-card h-100">
                                ${sliderHtml}
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <h5 class="product-title">${product.name}</h5>
                                        <h5 class="product-title arabic-text">${product.nameAr}</h5>
                                    </div>
                                    <p class="product-description">${product.description}</p>
                                    <div class="d-flex mt-2">
                                        <div>
                                            <div class="product-colors mb-2">
                                                ${colorDotsHtml}
                                            </div>
                                            <div class="product-rating mb-2">
                                                ${starsHtml} <span class="ms-1">${product.rating}</span>
                                            </div>
                                        </div>
                                        <div class="ms-auto">
                                            <div class="product-price text-end">$${product.price}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer bg-white border-top-0">
                                    <a href="${product.url}" class="btn btn-sm btn-outline-primary w-100">View Details</a>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                return html;
            }
            
            // Initialize Swiper sliders
            function initSwipers() {
                const swiperElements = document.querySelectorAll('.swiper');
                swiperElements.forEach(element => {
                    new Swiper(element, {
                        loop: true,
                        pagination: {
                            el: '.swiper-pagination',
                            clickable: true
                        },
                        navigation: {
                            nextEl: '.swiper-button-next',
                            prevEl: '.swiper-button-prev',
                        },
                        autoplay: {
                            delay: 3000,
                            disableOnInteraction: false
                        }
                    });
                });
            }
        });
    </script> -->

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const cameraBtn = document.getElementById('cameraBtn');
            const cameraView = document.getElementById('cameraView');
            const capturedImage = document.getElementById('capturedImage');
            const productImage = document.getElementById('productImage');
            const imagePreview = document.getElementById('imagePreview');
            const imagePreviewContainer = document.getElementById('imagePreviewContainer');
            const removeImageBtn = document.getElementById('removeImageBtn');
            const searchForm = document.getElementById('searchForm');
            let stream = null;
            
            const fileSelector = document.getElementById('fileSelector');
            const actualImageInput = document.getElementById('actualImageInput');
            
            // Camera functionality
            cameraBtn.addEventListener('click', async () => {
                if (cameraView.style.display === 'block') {
                    // Stop camera and capture image
                    if (stream) {
                        const videoTrack = stream.getVideoTracks()[0];
                        const canvas = document.createElement('canvas');
                        canvas.width = cameraView.videoWidth;
                        canvas.height = cameraView.videoHeight;
                        canvas.getContext('2d').drawImage(cameraView, 0, 0);
                        
                        // Convert to data URL and store in the single input
                        const imageDataURL = canvas.toDataURL('image/jpeg');
                        actualImageInput.value = imageDataURL;
                        
                        // Display preview
                        imagePreview.src = imageDataURL;
                        imagePreviewContainer.style.display = 'block';
                        
                        // Reset file selector to avoid conflicts
                        fileSelector.value = '';
                        
                        // Stop camera
                        videoTrack.stop();
                        stream = null;
                        cameraView.style.display = 'none';
                        cameraBtn.innerHTML = '<i class="bi bi-camera"></i> Camera';
                    }
                } else {
                    try {
                        // Start camera
                        stream = await navigator.mediaDevices.getUserMedia({ video: true });
                        cameraView.srcObject = stream;
                        cameraView.style.display = 'block';
                        cameraBtn.innerHTML = '<i class="bi bi-camera-fill"></i> Capture';
                    } catch (err) {
                        console.error('Error accessing camera:', err);
                        alert('Could not access camera. Please ensure you have given permission.');
                    }
                }
            });
            
            // File selection handling
            fileSelector.addEventListener('change', function() {
                if (this.files && this.files[0]) {
                    const file = this.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        // Store the file data in the single input
                        actualImageInput.value = e.target.result;
                        
                        // Display preview
                        imagePreview.src = e.target.result;
                        imagePreviewContainer.style.display = 'block';
                        
                        // Hide camera view if open
                        if (stream) {
                            const videoTrack = stream.getVideoTracks()[0];
                            videoTrack.stop();
                            stream = null;
                            cameraView.style.display = 'none';
                            cameraBtn.innerHTML = '<i class="bi bi-camera"></i> Camera';
                        }
                    };
                    
                    reader.readAsDataURL(file);
                }
            });
            
            // Remove image
            removeImageBtn.addEventListener('click', function() {
                imagePreview.src = '';
                imagePreviewContainer.style.display = 'none';
                fileSelector.value = '';
                actualImageInput.value = '';
            });
            
            // // File upload preview
            // productImage.addEventListener('change', function() {
            //     if (this.files && this.files[0]) {
            //         const file = this.files[0];
            //         const reader = new FileReader();
                    
            //         reader.onload = function(e) {
            //             // Display preview
            //             imagePreview.src = e.target.result;
            //             imagePreviewContainer.style.display = 'block';
                        
            //             // Clear captured image data if any
            //             capturedImage.value = '';
                        
            //             // Hide camera view if open
            //             if (stream) {
            //                 const videoTrack = stream.getVideoTracks()[0];
            //                 videoTrack.stop();
            //                 stream = null;
            //                 cameraView.style.display = 'none';
            //                 cameraBtn.innerHTML = '<i class="bi bi-camera"></i> Camera';
            //             }
            //         };
                    
            //         reader.readAsDataURL(file);
            //     }
            // });
            
            // Remove image preview
            removeImageBtn.addEventListener('click', function() {
                imagePreview.src = '';
                imagePreviewContainer.style.display = 'none';
                productImage.value = '';
                capturedImage.value = '';
            });
            
            // For debugging HTMX requests
            document.body.addEventListener('htmx:beforeRequest', function(evt) {
                console.log('HTMX Request about to be sent:', evt.detail);
            });
        
            // Handle API response
            document.body.addEventListener('htmx:afterOnLoad', function(evt) {
                try {
                    if (evt.detail.xhr.status === 200) {
                        console.log('Response received:', evt.detail.xhr.responseText);
                        
                        // Parse the JSON response
                        const response = JSON.parse(evt.detail.xhr.responseText);
                        
                        // Display the results
                        if (response && response.results && response.results.length > 0) {
                            const resultsHtml = generateProductCards(response.results);
                            document.getElementById('searchResults').innerHTML = resultsHtml;
                            
                            // Initialize sliders after rendering
                            setTimeout(() => {
                                initSwipers();
                            }, 100);
                        } else {
                            document.getElementById('searchResults').innerHTML = `
                                <div class="empty-results">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-search mb-3" viewBox="0 0 16 16">
                                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                                    </svg>
                                    <h4>No products found</h4>
                                    <p>Try searching with different terms or image</p>
                                </div>
                            `;
                        }
                    }
                } catch (error) {
                    console.error('Error processing response:', error);
                    document.getElementById('searchResults').innerHTML = `
                        <div class="alert alert-danger">
                            <h4>Error Processing Results</h4>
                            <p>There was a problem processing the search results.</p>
                        </div>
                    `;
                }
            });
        
            document.body.addEventListener('htmx:responseError', function(evt) {
                console.error('HTMX Response Error:', evt.detail);
                document.getElementById('searchResults').innerHTML = `
                    <div class="alert alert-danger">
                        <h4>Search Error</h4>
                        <p>Sorry, there was a problem with your search request. Please try again.</p>
                        <p>Status: ${evt.detail.xhr.status} ${evt.detail.xhr.statusText}</p>
                    </div>
                `;
            });
            
            // Generate HTML for product cards based on the actual API response format
            function generateProductCards(products) {
                if (!products || products.length === 0) {
                    return `
                        <div class="empty-results">
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-search mb-3" viewBox="0 0 16 16">
                                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                            </svg>
                            <h4>No products found</h4>
                            <p>Try searching with different terms or image</p>
                        </div>
                    `;
                }
                
                let html = '<div class="row">';
                
                products.forEach(product => {
                    // Generate color dots
                    let colorDotsHtml = '';
                    if (product.color && product.color.length > 0) {
                        product.color.forEach(colorName => {
                            // Convert color name to hex
                            const colorHex = getColorHex(colorName);
                            colorDotsHtml += `<span class="color-dot" style="background-color: ${colorHex};" title="${colorName}"></span>`;
                        });
                    }
                    
                    // Generate star rating based on product rank
                    const rating = Math.min(5, Math.max(0, product.rank || 0));
                    let starsHtml = '';
                    for (let i = 1; i <= 5; i++) {
                        if (i <= Math.floor(rating)) {
                            starsHtml += '<i class="bi bi-star-fill"></i> ';
                        } else if (i === Math.ceil(rating) && rating % 1 !== 0) {
                            starsHtml += '<i class="bi bi-star-half"></i> ';
                        } else {
                            starsHtml += '<i class="bi bi-star"></i> ';
                        }
                    }
                    
                    // Clean image URLs (removing spaces) and ensure array
                    const imageUrls = product.images_urls || [];
                    const cleanedImageUrls = imageUrls.map(url => url.trim());
                    
                    // Generate image slider
                    let sliderHtml = `
                        <div class="swiper product-swiper-${product.id || Math.random().toString(36).substring(7)}">
                            <div class="swiper-wrapper">
                    `;
                    
                    if (cleanedImageUrls.length > 0) {
                        cleanedImageUrls.forEach(image => {
                            sliderHtml += `
                                <div class="swiper-slide">
                                    <img src="${image}" alt="${product.english_name || 'Product'}" onerror="this.onerror=null; this.src='/api/placeholder/400/300?text=Image Not Available';">
                                </div>
                            `;
                        });
                    } else {
                        // Placeholder if no images
                        sliderHtml += `
                            <div class="swiper-slide">
                                <img src="" alt="No Image Available">
                            </div>
                        `;
                    }
                    
                    sliderHtml += `
                            </div>
                            <div class="swiper-pagination"></div>
                            <div class="swiper-button-next"></div>
                            <div class="swiper-button-prev"></div>
                        </div>
                    `;
                    
                    html += `
                        <div class="col-sm-6 col-md-4 col-lg-3">
                            <div class="card product-card h-100">
                                ${sliderHtml}
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <h5 class="product-title">${product.english_name || 'Unknown Product'}</h5>
                                        <h5 class="product-title arabic-text">${product.arabic_name || ''}</h5>
                                    </div>
                                    <p class="product-description">${product.description || 'No description available'}</p>
                                    <div class="d-flex mt-2">
                                        <div>
                                            <div class="product-colors mb-2">
                                                ${colorDotsHtml}
                                            </div>
                                            <div class="product-rating mb-2">
                                                ${starsHtml} <span class="ms-1">${rating.toFixed(1)}</span>
                                            </div>
                                        </div>
                                        <div class="ms-auto">
                                            <div class="product-price text-end">$${(product.price || 0).toFixed(2)}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer bg-white border-top-0">
                                    <a href="${product.url || '#'}" target="_blank" class="btn btn-sm btn-outline-primary w-100">View Details</a>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                return html;
            }
            
            // Helper function to convert color names to hex codes
            function getColorHex(colorName) {
                if (!colorName) return '#cccccc';
                
                const colorMap = {
                    'red': '#ff0000',
                    'blue': '#0000ff',
                    'green': '#008000',
                    'yellow': '#ffff00',
                    'black': '#000000',
                    'white': '#ffffff',
                    'orange': '#ffa500',
                    'purple': '#800080',
                    'pink': '#ffc0cb',
                    'brown': '#a52a2a',
                    'grey': '#808080',
                    'gray': '#808080',
                    'navy': '#000080',
                    'teal': '#008080',
                    'olive': '#808000',
                    'maroon': '#800000',
                    'gold': '#ffd700',
                    'silver': '#c0c0c0',
                    'beige': '#f5f5dc'
                };
                
                // Lowercase the color name for comparison
                const lowerColorName = colorName.toLowerCase();
                
                // Return the hex code if found, otherwise a default color
                return colorMap[lowerColorName] || '#cccccc';
            }
            
            // Initialize Swiper sliders
            function initSwipers() {
                const swiperElements = document.querySelectorAll('.swiper');
                swiperElements.forEach(element => {
                    new Swiper(element, {
                        loop: true,
                        pagination: {
                            el: '.swiper-pagination',
                            clickable: true
                        },
                        navigation: {
                            nextEl: '.swiper-button-next',
                            prevEl: '.swiper-button-prev',
                        },
                        autoplay: {
                            delay: 3000,
                            disableOnInteraction: false
                        }
                    });
                });
            }
        });
        </script>
</body>
</html>


